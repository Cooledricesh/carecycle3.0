# 기술 요구사항 문서 (TRD)

## 1. 기술 요약
- **프로젝트 개요**: 중형 병원 간호사를 위한 반복 검사/주사 일정 자동화 MVP 웹 애플리케이션 개발. Next.js 기반 프론트엔드와 Supabase를 활용한 백엔드 구성으로 빠른 개발 및 배포를 목표로 함. 사용자 경험을 최적화하기 위해 간단하고 직관적인 UI를 제공하며, 필수 기능 위주로 구현하여 빠른 MVP 출시를 지원함.
- **핵심 기술 스택**: Next.js 15, TypeScript, TailwindCSS, shadcn, lucide-react, Supabase(PostgreSQL + Auth), @tanstack/react-query, es-toolkit, date-fns, Web Push API
- **주요 기술 목표**:
    - 빠른 응답 속도 및 부드러운 사용자 경험 제공
    - 안정적인 데이터 관리 및 보안 유지
    - 확장 가능한 아키텍처 설계
- **주요 기술 가정**:
    - 사용자 환경은 최신 데스크톱 브라우저를 사용한다고 가정
    - Supabase의 안정적인 서비스 제공을 가정
    - 네트워크 연결 상태가 양호하다고 가정

## 2. 기술 스택

| 범주              | 기술 / 라이브러리             | 사유                                                                                                                                                                                                                                                                                                                                                                                                         |
| ----------------- | ---------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| 프레임워크        | Next.js 15                   | 서버 사이드 렌더링(SSR) 및 정적 사이트 생성(SSG)을 지원하여 초기 로딩 속도 향상. 라우팅, API 처리 등 다양한 기능을 내장하고 있어 개발 생산성 향상.                                                                                                                                                                                                                                                   |
| 언어              | TypeScript                   | 정적 타입 지원으로 코드 안정성 및 유지보수성 향상. 개발 단계에서 오류를 사전에 발견하여 런타임 오류 감소.                                                                                                                                                                                                                                                                                             |
| UI 프레임워크     | TailwindCSS                  | 유틸리티 우선 CSS 프레임워크로 빠른 UI 개발 가능. 컴포넌트 재사용성 및 일관성 유지.                                                                                                                                                                                                                                                                                                                               |
| UI 컴포넌트       | shadcn                       | 재사용 가능한 UI 컴포넌트 제공. 디자인 시스템 일관성 유지 및 개발 속도 향상.                                                                                                                                                                                                                                                                                                                                        |
| 아이콘            | lucide-react                 | 고품질의 벡터 아이콘 제공. UI 디자인 일관성 유지.                                                                                                                                                                                                                                                                                                                                                                 |
| 백엔드            | Supabase(PostgreSQL + Auth) | BaaS(Backend as a Service) 형태로 데이터베이스, 인증, 스토리지 등 백엔드 기능을 제공하여 서버 관리 부담 감소. PostgreSQL 기반으로 안정적인 데이터 관리 가능.                                                                                                                                                                                                                                                 |
| 상태 관리         | @tanstack/react-query        | 서버 상태 관리 라이브러리로 API 데이터 캐싱, 업데이트, 동기화 등 기능을 제공. 사용자 경험 향상 및 네트워크 요청 감소.                                                                                                                                                                                                                                                                                          |
| 유틸리티          | es-toolkit                   | 유용한 유틸리티 함수 제공 (예: 문자열 조작, 배열 처리 등). 코드 재사용성 및 개발 생산성 향상.                                                                                                                                                                                                                                                                                                                      |
| 날짜 처리         | date-fns                     | 날짜 및 시간 관련 기능 제공. 다양한 포맷 지원 및 시간대 처리.                                                                                                                                                                                                                                                                                                                                                        |
| 푸시 알림         | Web Push API                 | 브라우저 푸시 알림 기능 제공. 사용자에게 실시간 알림 제공.                                                                                                                                                                                                                                                                                                                                                          |

## 3. 시스템 아키텍처 설계

### 최상위 구성 요소
- **프론트엔드 (Next.js)**: 사용자 인터페이스 및 사용자 상호 작용 처리.
    - UI 컴포넌트 (shadcn, lucide-react)
    - 상태 관리 (@tanstack/react-query)
    - 라우팅 (Next.js 내장)
- **백엔드 (Supabase)**: 데이터 저장, 인증, API 제공.
    - 데이터베이스 (PostgreSQL)
    - 인증 (Supabase Auth)
    - API (Supabase Functions)
- **푸시 알림 (Web Push API)**: 사용자에게 알림 전송.
    - 푸시 서버 (Supabase Functions 또는 외부 서비스)
    - 브라우저 푸시 서비스

### 최상위 구성 요소 상호 작용 다이어그램

```mermaid
graph TD
    A[Frontend (Next.js)] --> B[Backend (Supabase)]
    B --> C[Database (PostgreSQL)]
    A --> D[Web Push API]
```

- **프론트엔드 (Next.js) -> 백엔드 (Supabase)**: 사용자의 요청 (예: 환자 등록, 일정 확인)을 API를 통해 Supabase로 전송합니다.
- **백엔드 (Supabase) -> 데이터베이스 (PostgreSQL)**: Supabase는 사용자의 요청에 따라 PostgreSQL 데이터베이스에서 데이터를 읽거나 씁니다.
- **프론트엔드 (Next.js) -> Web Push API**: 사용자에게 푸시 알림을 보내기 위해 Web Push API를 사용합니다. 프론트엔드는 사용자 브라우저에 푸시 구독을 요청하고, 구독 정보를 백엔드로 전송합니다.
- **백엔드 (Supabase) -> Web Push API**: 특정 이벤트 (예: 예정된 검사/주사 일정) 발생 시, 백엔드는 저장된 구독 정보를 사용하여 Web Push API를 통해 사용자에게 알림을 전송합니다.

### 코드 구성 & 컨벤션
**도메인 기반 구성 전략**
- **도메인 분리**: 사용자 관리, 일정 관리, 알림 등 비즈니스 도메인별로 코드 분리.
- **계층 기반 아키텍처**: 프레젠테이션 계층 (UI 컴포넌트), 비즈니스 로직 계층 (서비스), 데이터 접근 계층 (데이터베이스 쿼리)으로 분리.
- **기능 기반 모듈**: 환자 등록, 일정 생성, 체크리스트 관리 등 기능별로 모듈화.
- **공유 컴포넌트**: 공통 유틸리티, 타입, 재사용 가능한 컴포넌트는 shared 모듈에 저장.

**유니버설 파일 & 폴더 구조**
```
/
├── components/           # 재사용 가능한 UI 컴포넌트
│   ├── PatientCard.tsx
│   ├── Checkbox.tsx
│   └── ...
├── pages/                # Next.js 페이지 및 API 엔드포인트
│   ├── index.tsx         # 메인 대시보드
│   ├── patients/         # 환자 관련 페이지
│   │   ├── [id].tsx    # 특정 환자 상세 정보
│   │   └── new.tsx     # 신규 환자 등록
│   └── api/              # API 엔드포인트
│       ├── patients.ts   # 환자 관련 API
│       └── ...
├── services/             # 비즈니스 로직
│   ├── patientService.ts # 환자 관련 서비스
│   ├── scheduleService.ts # 일정 관련 서비스
│   └── ...
├── utils/                # 유틸리티 함수
│   ├── dateUtils.ts      # 날짜 관련 유틸리티
│   ├── api.ts            # API 클라이언트
│   └── ...
├── types/                # 타입 정의
│   ├── patient.ts        # 환자 타입
│   ├── schedule.ts       # 일정 타입
│   └── ...
└── ...
```

### 데이터 흐름 & 통신 패턴
- **클라이언트-서버 통신**: API 요청/응답 패턴 (RESTful API).
- **데이터베이스 상호 작용**: Supabase 클라이언트 라이브러리를 사용하여 데이터베이스 쿼리.
- **외부 서비스 통합**: Web Push API를 사용하여 푸시 알림 전송.
- **실시간 통신**: 실시간 기능은 필요하지 않음.
- **데이터 동기화**: @tanstack/react-query를 사용하여 서버 상태와 클라이언트 상태 동기화.

## 4. 성능 & 최적화 전략
- **코드 분할 (Code Splitting)**: Next.js의 코드 분할 기능을 활용하여 초기 로딩 속도 최소화.
- **이미지 최적화**: 이미지 크기 최적화 및 Lazy Loading 적용.
- **API 응답 캐싱**: @tanstack/react-query를 사용하여 API 응답 캐싱.
- **데이터베이스 쿼리 최적화**: 필요한 데이터만 조회하도록 쿼리 최적화. 인덱싱 활용.

## 5. 구현 로드맵 & 마일스톤
### 1단계: 기반 (MVP 구현)
- **핵심 인프라**: Next.js 프로젝트 설정, Supabase 연동, 기본 UI 구성.
- **필수 기능**: 환자 등록, 항목 등록, 반복 주기 설정, 다음 예정일 자동 계산, 오늘 예정 환자 자동 리스트업, 시행 여부 체크박스.
- **기본 보안**: 환자정보 암호화 저장, HTTPS 통신.
- **개발 환경 설정**: 개발 환경 구축, CI/CD 파이프라인 설정.
- **예상 완료 기간**: 2주

### 2단계: 기능 개선
- **고급 기능**: 알림 기능 (대시보드 표시, Push 알림), 대시보드 (항목별 진행 현황 요약), 사용자 정의 항목.
- **성능 최적화**: 시스템 성능 개선.
- **보안 강화**: 보안 기능 강화 및 컴플라이언스 준수.
- **모니터링 구현**: 종합적인 모니터링 시스템 설정.
- **예상 완료 기간**: 3주

## 6. 위험 평가 & 완화 전략
### 기술적 위험 분석
- **기술 위험**: Next.js, Supabase 등 기술 스택에 대한 이해 부족.
- **성능 위험**: 데이터 증가에 따른 성능 저하 가능성.
- **보안 위험**: 환자 정보 유출 가능성.
- **통합 위험**: Web Push API 연동 문제.
- **완화 전략**:
    - 기술 스택 학습 및 숙련.
    - 성능 테스트 및 최적화.
    - 보안 취약점 점검 및 보안 강화.
    - Web Push API 연동 테스트 및 문제 해결.

### 프로젝트 납기 위험
- **일정 위험**: 개발 일정 지연 가능성.
- **자원 위험**: 개발 인력 부족 가능성.
- **품질 위험**: 코드 품질 저하 가능성.
- **배포 위험**: 배포 환경 문제 발생 가능성.
- **비상 계획**:
    - 개발 일정 단축 및 우선순위 조정.
    - 추가 개발 인력 확보.
    - 코드 리뷰 및 테스트 강화.
    - 배포 환경 사전 점검 및 문제 해결.
